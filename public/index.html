<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Grid HQ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0f;
      --glass: rgba(255,255,255,0.035);
      --border: rgba(255,255,255,0.07);
      --accent: #7dd3fc;
    }
    body {
      font-family: 'Space Grotesk', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: var(--bg);
      color: #e8e8ed;
    }
    .mono { font-family: 'JetBrains Mono', ui-monospace, SFMono-Regular, Menlo, monospace; }
    .glass { background: var(--glass); border: 1px solid var(--border); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); }
    .btn { border-radius: 12px; padding: 10px 14px; font-weight: 600; font-size: 14px; }
    .btn-primary { background: linear-gradient(135deg, rgba(125,211,252,0.95), rgba(56,189,248,0.95)); color: #061018; }
    .btn-secondary { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.10); color: rgba(232,232,237,0.75); }
    .card { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08); }
    .lane { min-height: 240px; }
    .sortable-ghost { opacity: 0.4; }
    .sortable-drag { opacity: 0.8; }
    .priority-low { border-left: 3px solid #6b7280; }
    .priority-medium { border-left: 3px solid #3b82f6; }
    .priority-high { border-left: 3px solid #f59e0b; }
    .priority-urgent { border-left: 3px solid #ef4444; }
    .overdue { border-left: 3px solid #dc2626 !important; }
    @media (max-width: 768px) {
      .lane { min-height: 180px; }
      .card { min-height: 60px; touch-action: pan-y; }
      .btn { min-height: 44px; min-width: 44px; }
      #kanban-board { overflow-x: auto; -webkit-overflow-scrolling: touch; scroll-snap-type: x mandatory; }
      #kanban-board > div { scroll-snap-align: start; min-width: 85vw; }
      #card-modal > div { max-height: 95vh; margin: 2.5vh auto; }
    }
    @media (max-width: 640px) {
      #kanban-board > div { min-width: 90vw; }
    }
  </style>
</head>
<body>
  <nav class="fixed top-0 inset-x-0 z-50 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-xl flex items-center justify-center" style="background: rgba(125,211,252,0.12); border: 1px solid rgba(125,211,252,0.25);">
          <span class="mono font-bold" style="color: var(--accent);">HQ</span>
        </div>
        <div>
          <div class="font-semibold tracking-tight">Daily Grid HQ</div>
          <div class="text-xs text-white/45">Shared dashboard</div>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div id="whoami" class="text-xs text-white/55 mono"></div>
        <a class="btn btn-secondary" href="/api/health" target="_blank" rel="noreferrer">API</a>
      </div>
    </div>
  </nav>

  <main class="max-w-6xl mx-auto px-4 pt-20 pb-10">
    <header class="flex flex-col gap-3 md:flex-row md:items-end md:justify-between mb-6">
      <div>
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/5 border border-white/10 text-white/70 text-xs font-medium uppercase tracking-widest">
          <span class="w-1.5 h-1.5 rounded-full" style="background: var(--accent);"></span>
          Ops Dashboard
        </div>
        <h1 class="text-3xl font-bold mt-3">Kanban</h1>
        <p class="text-white/45 mt-1 text-sm">Backlog + status for Zac ↔ Friday.</p>
      </div>

      <div class="flex flex-col gap-2 w-full md:w-[420px]">
        <div class="glass rounded-2xl p-3 flex gap-2 mb-2">
          <input id="search-input" type="text" class="flex-1 bg-transparent border border-white/10 rounded-xl px-3 py-2 text-sm text-white placeholder:text-white/35" placeholder="Search cards…" aria-label="Search cards" />
          <button id="clear-search" class="btn btn-secondary hidden" aria-label="Clear search">Clear</button>
        </div>
        <form id="new-card-form" class="glass rounded-2xl p-3 flex gap-2">
          <input id="new-card-title" class="flex-1 bg-transparent border border-white/10 rounded-xl px-3 py-2 text-sm text-white placeholder:text-white/35" placeholder="Add a task…" maxlength="140" aria-label="New task title" />
          <button class="btn btn-primary" type="submit" aria-label="Add task">Add</button>
        </form>
        <div class="flex items-center gap-2 text-xs text-white/40 flex-wrap">
          <kbd class="px-2 py-1 bg-white/5 border border-white/10 rounded">n</kbd> new task
          <kbd class="px-2 py-1 bg-white/5 border border-white/10 rounded">/</kbd> search
          <kbd class="px-2 py-1 bg-white/5 border border-white/10 rounded">?</kbd> shortcuts
        </div>
      </div>
    </header>

    <section class="grid grid-cols-1 md:grid-cols-4 gap-4 overflow-x-auto" id="kanban-board">
      <div class="glass rounded-2xl p-3 min-w-[280px]">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold" aria-label="Backlog column">Backlog</h2>
          <span class="text-xs text-white/45 mono" data-count="backlog" aria-label="Number of cards in backlog">0</span>
        </div>
        <div class="lane space-y-2" data-lane="backlog" role="list" aria-label="Backlog cards"></div>
      </div>

      <div class="glass rounded-2xl p-3 min-w-[280px]">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold" aria-label="Doing column">Doing</h2>
          <span class="text-xs text-white/45 mono" data-count="doing" aria-label="Number of cards in doing">0</span>
        </div>
        <div class="lane space-y-2" data-lane="doing" role="list" aria-label="Doing cards"></div>
      </div>

      <div class="glass rounded-2xl p-3 min-w-[280px]">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold" aria-label="Blocked column">Blocked</h2>
          <span class="text-xs text-white/45 mono" data-count="blocked" aria-label="Number of cards in blocked">0</span>
        </div>
        <div class="lane space-y-2" data-lane="blocked" role="list" aria-label="Blocked cards"></div>
      </div>

      <div class="glass rounded-2xl p-3 min-w-[280px]">
        <div class="flex items-center justify-between mb-3">
          <h2 class="font-semibold" aria-label="Done column">Done</h2>
          <span class="text-xs text-white/45 mono" data-count="done" aria-label="Number of cards in done">0</span>
        </div>
        <div class="lane space-y-2" data-lane="done" role="list" aria-label="Done cards"></div>
      </div>
    </section>

    <section class="mt-6 glass rounded-2xl p-4">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h2 class="font-semibold">Status</h2>
          <p class="text-white/45 text-sm">Board statistics and system health.</p>
        </div>
        <button id="refresh-status" class="btn btn-secondary" aria-label="Refresh status">Refresh</button>
      </div>
      <div id="status-summary" class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4"></div>
      <div id="status-details" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div class="bg-white/5 rounded-xl p-3">
          <div class="text-xs text-white/60 mb-2">Health</div>
          <div id="health-indicator" class="flex items-center gap-2">
            <span class="w-2 h-2 rounded-full bg-green-400"></span>
            <span class="text-sm">Operational</span>
          </div>
        </div>
        <div class="bg-white/5 rounded-xl p-3">
          <div class="text-xs text-white/60 mb-2">Last Updated</div>
          <div id="last-update" class="text-sm mono">Just now</div>
        </div>
      </div>
      <details class="mt-4">
        <summary class="cursor-pointer text-sm text-white/60 hover:text-white/80">Show raw status</summary>
        <pre id="status" class="mt-3 text-xs text-white/70 mono overflow-auto"></pre>
      </details>
    </section>

    <section class="mt-4 glass rounded-2xl p-4">
      <div class="flex items-center justify-between mb-3">
        <div>
          <h2 class="font-semibold">Friday Status</h2>
          <p class="text-white/45 text-sm">A little live note for what I’m up to.</p>
        </div>
        <div class="flex items-center gap-2">
          <select id="friday-mode" class="bg-transparent border border-white/10 rounded-xl px-2 py-2 text-xs text-white/80" aria-label="Friday mode">
            <option value="idle">idle</option>
            <option value="working">working</option>
            <option value="waiting">waiting</option>
            <option value="sleeping">sleeping</option>
          </select>
          <button id="save-friday" class="btn btn-primary" aria-label="Save Friday status">Save</button>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <textarea id="friday-message" rows="4" class="w-full bg-transparent border border-white/10 rounded-2xl px-3 py-2 text-sm text-white placeholder:text-white/35" placeholder="What Friday is doing…" aria-label="Friday status message"></textarea>
          <div class="text-xs text-white/40 mono mt-2" id="friday-updated"></div>
        </div>
        <div class="bg-white/5 rounded-xl p-3">
          <div class="text-xs text-white/60 mb-2">Focus card</div>
          <div class="text-sm mono" id="friday-focus">(none)</div>
          <div class="text-xs text-white/45 mt-3">Automation can set this when I pick up tasks.</div>
        </div>
      </div>
    </section>

    <!-- Card Detail Modal -->
    <div id="card-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="glass rounded-2xl p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-4">
          <h3 id="modal-title" class="text-xl font-semibold">Card Details</h3>
          <button id="close-modal" class="w-8 h-8 rounded-xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5" aria-label="Close modal">×</button>
        </div>
        <div id="modal-content"></div>
      </div>
    </div>

    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcuts-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/60 backdrop-blur-sm" role="dialog" aria-modal="true" aria-labelledby="shortcuts-title">
      <div class="glass rounded-2xl p-6 max-w-lg w-full mx-4">
        <div class="flex items-center justify-between mb-4">
          <h3 id="shortcuts-title" class="text-xl font-semibold">Keyboard Shortcuts</h3>
          <button id="close-shortcuts" class="w-8 h-8 rounded-xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5" aria-label="Close shortcuts">×</button>
        </div>
        <div id="shortcuts-content" class="space-y-2 text-sm"></div>
      </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 z-50 hidden glass rounded-xl px-4 py-3 shadow-lg" role="alert"></div>

    <p class="text-xs text-white/35 mt-8">Tip: Put Cloudflare Access in front of this app. The API reads <span class="mono">Cf-Access-Authenticated-User-Email</span>.</p>
  </main>

  <script type="module" src="/app.js"></script>
</body>
</html>
